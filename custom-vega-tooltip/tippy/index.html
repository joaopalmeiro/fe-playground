<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Custom tooltip for Vega-Lite</title>

    <script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-tooltip@0.25.0"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
  </head>
  <body style="text-align: center">
    <div id="vis"></div>

    <script type="text/javascript">
      var spec = {
        $schema: "https://vega.github.io/schema/vega-lite/v4.json",
        description: "A simple bar chart with embedded data.",
        data: {
          values: [
            { a: "A", b: 28 },
            { a: "B", b: 55 },
            { a: "C", b: 43 },
            { a: "D", b: 91 },
            { a: "E", b: 81 },
            { a: "F", b: 53 },
            { a: "G", b: 19 },
            { a: "H", b: 87 },
            { a: "I", b: 52 },
          ],
        },
        width: 300,
        height: 300,
        mark: { type: "bar", tooltip: true },
        encoding: {
          x: { field: "a", type: "nominal", axis: { labelAngle: 0 } },
          y: { field: "b", type: "quantitative" },
        },
      };

      class CustomHandler extends vegaTooltip.Handler {
        // More info:
        // - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#sub_classing_with_extends.
        // - https://javascript.info/class-inheritance.
        constructor(selector, options) {
          super(options);
          this.tippy = selector;
        }

        tooltipHandler(handler, event, item, value) {
          if (value) {
            console.log(value);
            tippy(".marks", {
              content: "My tooltip!",
              followCursor: true,
              interactive: true,
              duration: 0,
              arrow: false,
            });
          }
        }
      }

      const customHandler = new CustomHandler(".marks");

      // console.log(customHandler);

      vegaEmbed("#vis", spec, {
        tooltip: customHandler.call,
      });
    </script>
  </body>
</html>
